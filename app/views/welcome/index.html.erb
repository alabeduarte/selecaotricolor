<% content_for :title, "Escale o seu Time!" %>
<input id="host" type="hidden" value=<%= "#{request.host}" %> />
<div class="welcome">	
	<div class="facebook-like">
		<%= render :partial => 'rating/facebook_like', :locals => {:uri => current_uri} %>
	</div>			
	<h1 class="app-description">Um site interativo, não oficial, exclusivo para a torcida do BAHIA.</h1>
	<% if @next_match %>
		<h1 class="subtitle">escale o seu time para a próxima partida</h1>
		<div class='pills match-calendars'>
			<%= link_to "Calendário dos Jogos", :calendars, :class => 'button match-calendar' %>
			<%= link_to "Táticas enviadas até agora", {:controller => 'calendars', :action => 'formations_matches', :id => @next_match}, :class => 'button formations' %>
			<%= link_to "Ranking dos usuários!", '/scores', :class => 'button ranking' %>			
		</div>
		<div class="pills actions">
			<%= link_to "Entenda como funciona o nosso site!", '/scores/rules', :class => 'button question' %>
		</div>
		<%= render :partial => "calendars/match_info", :locals => {:match => @next_match, :subtitle => false} %>			
		<div class="pills actions large">
			<%= link_to "ESCALE O SEU TIME!", new_path, :class => "button new-formation" %>
		</div>
	<% end %>
	<% if @formation %>
		<h1 class="subtitle">partida Anterior</h1>
		<div class="formation-header">
			<h2 class="tactical"><%= "#{@formation.tactical}" %></h2>			
		</div>
		<div class="last-squad-of-the-round">
			<div class="rating call-up">
				<table id="squad_of_the_round">
					<% @formation.players_ordered_by_positions.each do |position| %>
				  	<tr>
						<td class="position"><%= position.acronym %></td>
					    <td><%= position.player.name %></td>
						<td>
							<fb:like show_faces="no" layout="button_count" href=<%= "#{request.host}/positions/like/#{position.id}" %>></fb:like>
						</td>
					</tr>
					<% end %>
				</table>
			</div>
			<div id="soccerField" class="soccer-field-grass show">
				<div id="emptySlot"></div>
			</div>
			<div id="creator-info" class="show">
				<ul>
					<li><%= "#{t(:sended_to)} #{@formation.owner.nickname}" %></li>
					<li><%= "#{t(:created_at)} #{@formation.created_at.to_s(:day)}" %></li>
					<li class="jogo">
						<div class="time home">
							<%= image_tag("escudos/#{@formation.match.home.label}.png", :size => "45x45") %>

				        </div>
				        <div class="x">x</div>
				        <div class="time away">				       
							<%= image_tag("escudos/#{@formation.match.away.label}.png", :size => "45x45") %>
				        </div>
					</li>
				</ul>
				<div class="recent-winners">
					<div class="link">
						Para ver as táticas deste jogo, <%= link_to "clique aqui!", :controller => 'calendars', :action => 'formations_matches', :id => @formation.match %>
					</div>
					<% if @recent_winners.empty? %>
						<ul>						
							<li>Nenhum dos usuários acertaram a escalação desta partida! =/</li>
						</ul>
					<% else %>
						<div class="champions-of-round">
							<span class="champions-of-round-icon"></span>
							Técnicos da Rodada
						</div>						
						<div class="recent-winners champions-of-round">
							<table>
							<% @recent_winners.each do |u| %>
							  	<tr>							
								    <td>
										<%= image_tag(u.image, :size => "25x25", :class => 'user-avatar') %>
										:: <span class="nickname"><b><%= u.nickname %></b></span>
									</td>
								</tr>
							<% end %>
							</table>
						</div>
					<% end %>         		
				</div>
			</div>
		</div>
	<% end %>		

</div>		
<div class="welcome footer">	
</div>
<%= content_for :javascript do %>
	$( load_soccer_field );
	$( load_formation_of_last_round );
	

	FB.Event.subscribe('edge.create', function(response) {
		var uri = response.replace($('#host').val(), "");
		if (response.indexOf("positions/like") > 0) {
			$.ajax({
		  			url:   uri,
					type:  "POST"
			});
		}		
	});
	
	FB.Event.subscribe('edge.remove', function(response) {
		var uri = response.replace($('#host').val(), "");
		if (response.indexOf("positions/like") > 0) {
			$.ajax({
		  			url:   uri,
					type:  "DELETE"
			});
		}		
	});

<% end %>